prefix	    = @prefix@
exec_prefix = @exec_prefix@

bindir	    = @bindir@
mandir	    = @mandir@

CC	= @CC@
CFLAGS	= @CFLAGS@
DEFS	= @DEFS@
LIBS	= @LIBS@

INSTALL = @INSTALL@
RM	= rm -vf

MAIN	= wavemon.c
PURESRC	= $(filter-out $(MAIN),$(wildcard *.c))
OBJS	= $(PURESRC:.c=.o)

%.o: %.c wavemon.h llist.h iw_if.h
	$(CC) $(CFLAGS) $(DEFS) -c -o $@ $<

wavemon: $(MAIN) $(OBJS)
	$(CC) $(CFLAGS) $(LIBS) $^ -o $@

$(MAIN): Makefile
Makefile: Makefile.in config.status
	./config.status
config.status: configure
	./config.status --recheck
configure: configure.in
	autoconf

tags: $(wildcard *[ch])
	ctags $^ > $@

.PHONY: install uninstall clean distclean

install: wavemon wavemon.1 wavemonrc.5
	$(INSTALL) -m 0755 -d $(DESTDIR)$(bindir)
	$(INSTALL) -m 0755 wavemon $(DESTDIR)$(bindir)
	$(INSTALL) -m 0755 -d $(DESTDIR)$(mandir)/man1
	$(INSTALL) -m 0644 wavemon.1 $(DESTDIR)$(mandir)/man1
	$(INSTALL) -m 0755 -d $(DESTDIR)$(mandir)/man5
	$(INSTALL) -m 0644 wavemonrc.5 $(DESTDIR)$(mandir)/man5

uninstall:
	@$(RM) $(bindir)/wavemon
	@$(RM) $(mandir)/man1/wavemon.1
	@$(RM) $(mandir)/man5/wavemonrc.5

clean:
	@$(RM) *.o *.doc wavemon tags

distclean: uninstall clean
	@$(RM) config.status config.log config.cache Makefile
